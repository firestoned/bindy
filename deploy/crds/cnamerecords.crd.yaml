# Copyright (c) 2025 Erick Bourgeois, firestoned
# SPDX-License-Identifier: MIT
#
# This file is AUTO-GENERATED from src/crd.rs
# DO NOT EDIT MANUALLY - Run `cargo run --bin crdgen` to regenerate
#
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: cnamerecords.bindy.firestoned.io
spec:
  group: bindy.firestoned.io
  names:
    categories: []
    kind: CNAMERecord
    plural: cnamerecords
    shortNames:
    - cname
    singular: cnamerecord
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.name
      name: Name
      type: string
    - jsonPath: .status.zoneRef.zoneName
      name: Zone
      type: string
    - jsonPath: .spec.target
      name: Target
      type: string
    - jsonPath: .spec.ttl
      name: TTL
      type: integer
    - jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: CNAMERecord creates a DNS alias from one hostname to another. A CNAME cannot coexist with other record types for the same name.
        properties:
          spec:
            description: |-
              `CNAMERecord` creates an alias from one name to another.

              CNAME (Canonical Name) records create an alias from one DNS name to another.
              The target can be in the same zone or a different zone.

              **Important**: A CNAME cannot coexist with other record types for the same name.

              # Example

              ```yaml
              apiVersion: bindy.firestoned.io/v1beta1
              kind: CNAMERecord
              metadata:
                name: blog-example-com
                namespace: dns-system
                labels:
                  zone: example.com
              spec:
                name: blog
                target: example.github.io.
                ttl: 3600
              ```

              Records are associated with `DNSZones` via label selectors.
              The `DNSZone` must have a `recordsFrom` selector that matches this record's labels.
            properties:
              name:
                description: |-
                  Record name within the zone.

                  Note: CNAME records cannot be created at the zone apex (@).
                type: string
              target:
                description: |-
                  Target hostname (canonical name).

                  Should be a fully qualified domain name ending with a dot.
                  Example: "example.com." or "www.example.com."
                type: string
              ttl:
                description: Time To Live in seconds.
                format: int32
                maximum: 2147483647.0
                minimum: 0.0
                nullable: true
                type: integer
            required:
            - name
            - target
            type: object
          status:
            description: Generic record status
            nullable: true
            properties:
              addresses:
                description: |-
                  Comma-separated list of addresses for display purposes.

                  For `ARecord` and `AAAARecord` resources, this field contains the IP addresses
                  from `spec.ipv4Addresses` or `spec.ipv6Addresses` joined with commas.
                  This is used for prettier kubectl output instead of showing JSON arrays.

                  Example: "192.0.2.1,192.0.2.2,192.0.2.3"

                  For other record types, this field is not used.
                nullable: true
                type: string
              conditions:
                default: []
                items:
                  description: |-
                    Condition represents an observation of a resource's current state.

                    Conditions are used in status subresources to communicate the state of
                    a resource to users and controllers.
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status to another (RFC3339 format).
                      nullable: true
                      type: string
                    message:
                      description: Human-readable message indicating details about the transition.
                      nullable: true
                      type: string
                    reason:
                      description: Brief CamelCase reason for the condition's last transition.
                      nullable: true
                      type: string
                    status:
                      description: 'Status of the condition: True, False, or Unknown.'
                      type: string
                    type:
                      description: 'Type of condition. Common types include: Ready, Available, Progressing, Degraded, Failed.'
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              lastUpdated:
                description: |-
                  Timestamp of the last successful update to BIND9.

                  This is updated after a successful nsupdate operation.
                  Uses RFC 3339 format (e.g., "2025-12-26T10:30:00Z").
                nullable: true
                type: string
              observedGeneration:
                format: int64
                nullable: true
                type: integer
              recordHash:
                description: |-
                  SHA-256 hash of the record's spec data.

                  Used to detect when a record's data has actually changed, avoiding
                  unnecessary BIND9 updates and zone transfers.

                  The hash is calculated from all fields in the record's spec that affect
                  the DNS record data (name, addresses, TTL, etc.).
                nullable: true
                type: string
              zone:
                description: |-
                  The FQDN of the zone that owns this record (set by `DNSZone` controller).

                  When a `DNSZone`'s label selector matches this record, the `DNSZone` controller
                  sets this field to the zone's FQDN (e.g., `"example.com"`). The record reconciler
                  uses this to determine which zone to update in BIND9.

                  If this field is empty, the record is not matched by any zone and should not
                  be reconciled into BIND9.

                  **DEPRECATED**: Use `zone_ref` instead for structured zone reference.
                nullable: true
                type: string
              zoneRef:
                description: |-
                  Structured reference to the `DNSZone` that owns this record.

                  Set by the `DNSZone` controller when the zone's `recordsFrom` selector matches
                  this record's labels. Contains the complete Kubernetes object reference including
                  apiVersion, kind, name, namespace, and zoneName.

                  The record reconciler uses this to:
                  1. Look up the parent `DNSZone` resource
                  2. Find the zone's primary `Bind9Instance` servers
                  3. Add this record to BIND9 on primaries
                  4. Trigger zone transfer (retransfer) on secondaries

                  If this field is None, the record is not selected by any zone and will not
                  be added to BIND9.
                nullable: true
                properties:
                  apiVersion:
                    description: API version of the `DNSZone` resource (e.g., "bindy.firestoned.io/v1beta1")
                    type: string
                  kind:
                    description: Kind of the resource (always "`DNSZone`")
                    type: string
                  lastReconciledAt:
                    description: |-
                      Timestamp when this zone was last successfully configured on the instance.

                      This field is set by the `DNSZone` controller after successfully applying zone configuration
                      to the instance. It is reset to `None` when:
                      - The instance's pod restarts (requiring zone reconfiguration)
                      - The instance's spec changes (requiring reconfiguration)

                      The `DNSZone` controller uses this field to determine which instances need zone configuration.
                      If this field is `None`, the zone needs to be configured on the instance.
                    nullable: true
                    type: string
                  name:
                    description: Name of the `DNSZone` resource
                    type: string
                  namespace:
                    description: Namespace of the `DNSZone` resource
                    type: string
                  zoneName:
                    description: Fully qualified domain name from the zone's spec (e.g., "example.com")
                    type: string
                required:
                - apiVersion
                - kind
                - name
                - namespace
                - zoneName
                type: object
            type: object
        required:
        - spec
        title: CNAMERecord
        type: object
    served: true
    storage: true
    subresources:
      status: {}
